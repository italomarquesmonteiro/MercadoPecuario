---
title: "Indicador do Boi Gordo"
description: ""
author script: 
  - name: "Ítalo Marques-Monteiro"
    github: https://github.com/italomarquesmonteiro
    kaggle: https://www.kaggle.com/talomarquesmonteiro
    linkedin: linkedin.com/in/ítalo-monteiro-0b2516144
    lattes: http://lattes.cnpq.br/7174985368517137
    orcid_id: https://orcid.org/0000-0003-4367-1034
    affiliation: Anhanguera College  
        - Department: Veterinary Medicine
date: "2023-08-18"
output: html_document
---

```{r} 
library(tidyverse)
```

```{r}
praca_sp  <- readr::read_csv("Dataset index/CepeaBoiGordo.csv") |>
    dplyr::select(-a_vista_us)
```



```{r}
label_title <- "Comportamento do preço do boi gordo na praças de São Paulo e Rio Grande do Sul" # nolint
label_caption <- "Nota: Os preços do boi gordo no Rio Grande do Sul são precificados em quilo e foram transformados para unidade de medida de @, usando o valor de 15 kg. \nDados do Boi Gordo RS: Núcleo de Estudos em Sistemas de Produção de Bovinos de Corte e Cadeia Produtiva (NESPro-UFRGS) \nDados do Boi Gordo SP:Centro de Estudos Avançados em Economia Aplicada (Cepea-Esalq) \nPlot: @italo.m.m" # nolint
```



```{r}
gordo |>
    dplyr::rename(preco = variavel) |>
    dplyr::select(data, preco, pc_macho) |>
    dplyr::mutate(pc_macho = pc_macho * 15) |>
    dplyr::full_join(boi_sp) |>
  tidyr::pivot_longer(
    !c(data, preco),
      names_to = "categoria",
        values_to = "arroba"
  ) |>
  dplyr::mutate(
    categoria = case_when(
      categoria == "pc_macho" ~ "Boi Gordo RS",
      categoria == "a_vista_r" ~ "Boi Gordo SP",
      TRUE ~ categoria
    )
  ) |>
  dplyr::filter(data >= "2020-07-27") |>
  ggplot2::ggplot(
    mapping = aes(
      x = data,
        y = arroba,
          color = categoria
    )
  ) +
  geom_smooth(method = "gam") +
  geom_line(na.rm = TRUE) +
  labs(
    title = label_title,
      x = "Data",
          color = "Categorias",
            caption = label_caption
  ) +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y") +
  scale_y_continuous(breaks = seq(100, 360, 20), labels = scales::dollar_format(
    prefix = "R$ ", suffix = " @")) +
  scale_color_manual(values = c(
    "goldenrod3",
    "#0072B2"
    "mediumpurple1"
    )
  ) +
  guides(fill = "none") +
  theme(
        plot.title = ggtext::element_markdown(face = "bold", family = "Source Sans Pro", size = 25, hjust = 0, color = "gray40",), # nolint
        plot.caption = element_text(face = "bold", family = "Fira Sans Pro", size = 12, color = "gray70"), # nolint
        panel.background = element_rect(fill = "white", color = "grey90"),
        plot.background = element_rect(fill = "white"),
        panel.grid = element_line(color = "grey90"),
        legend.background = element_rect(fill = "white", color = "white"),
        legend.position = c(0.5, 0.5),
        legend.key = element_rect(fill = "grey90", color = "grey90"),
        legend.text = element_text(color = "grey40", size = 12),
        legend.title = element_text(face = "bold", color = "grey40"),
        axis.title.x = ggtext::element_markdown(face = "bold", family = "Fira Sans",size = 15, hjust = 0, color = "gray50"), # nolint,
        axis.title.y = element_blank() ,
        axis.text.y = ggtext::element_markdown(face = "bold", family = "Fira Sans",size = 8, hjust = 0, color = "gray50"), # nolint,
        axis.text.x = ggtext::element_markdown(
          face = "bold", family = "Fira Sans",size = 8, color = "gray50", angle=60, hjust=1) # nolint
  )
```
