---
title: "Relação de troca do boi gordo"
description: "A relação de troca do boi gordo é um indicador crucial na pecuária, destacando a proporção entre o preço de venda do boi gordo e o custo de aquisição de outros produtos, como gado de reposição. Essa métrica não apenas sinaliza a viabilidade econômica da transição entre fases do ciclo pecuário, mas também indica a capacidade do pecuarista em adquirir animais de reposição ou investir em outros insumos essenciais para a produção. Uma relação de troca favorável sugere uma maior capacidade de compra, enquanto uma relação desfavorável pode impactar as decisões estratégicas do pecuarista em termos de retenção, venda ou investimento no seu rebanho."
author script: 
  - name: "Ítalo Marques-Monteiro"
    github: https://github.com/italomarquesmonteiro
    kaggle: https://www.kaggle.com/talomarquesmonteiro
    linkedin: linkedin.com/in/italomarquesmonteiro
    medium: https://medium.com/@italomarquesmonteiro
    lattes: http://lattes.cnpq.br/7174985368517137
    orcid_id: https://orcid.org/0000-0003-4367-1034
    affiliation: Smart Data
        
date: "2024-01-26"
output: html_document
---

```{r Library}
library(tidyverse)
```

```{r Datasets}
bezerro <- readr::read_csv("c:/Users/italo/OneDrive/Área de Trabalho/GitHub/Cepea-Esalq/.vscode/Dataset cepea/CalfPrice.csv") |> # nolint
  dplyr::select(data, preco_bezerro = a_vista_r)

boi <- readr::read_csv("c:/Users/italo/OneDrive/Área de Trabalho/GitHub/Cepea-Esalq/.vscode/Dataset cepea/CepeaBoiGordo.csv" ) |> # nolint 
  dplyr::select(data, arroba_boi = a_vista_r)
```

A fórmula para usada calcular a relação de troca da @ boi gordo é:
  **Relação de troca** = *Preço da @ boi grodo / Preço do bezerro*

```{r Joining}
dataset_rt <- boi |>
  dplyr::inner_join(bezerro) |>
  dplyr::mutate(ano = year(data), mes = month(data), .before = data) |>
  print(n = 30)
```

```{r summarise}
relacao_troca <- dataset_rt |>
  dplyr::mutate(rt = preco_bezerro / arroba_boi) |>
  dplyr::group_by(ano, mes) |>
  dplyr::summarise(rt_medio = mean(rt, na.rm = FALSE)) |>
  dplyr::mutate(data = lubridate::ymd(paste(ano, mes, "01")), .before = rt_medio) # nolint
```

```{r period average}
relacao_troca |> #arrange(desc(rt_medio))
  dplyr::select(rt_medio) |>
  dplyr::mutate(media_periodo = mean(rt_medio))
```


```{r}
bg <- "white"
txt_col <- "black"

font <- "Josefin Sans"
font2 <- "Open Sans"

# Use the font_add_google() function to load fonts from the web
sysfonts::font_add_google(family = font, font, db_cache = FALSE)
sysfonts::font_add_google(family = font2, font2, db_cache = FALSE)

sysfonts::font_add(family = "Font Awesome 6 Brands", regular = "C:/Users/italo/AppData/Local/Microsoft/Windows/Fonts/Font Awesome 6 Brands-Regular-400.otf") # nolint

theme_set(theme_minimal(base_family = font2, base_size = 3))

showtext::showtext_opts(dpi = 300)
showtext::showtext_auto(enable = TRUE)


github_icon <- "&#xf09b"
linkedin_icon <- "&#xf0e1"
x_icon <- "&#xf099"
instagram_icon <- "&#xf16d"
github_username <- "italomarquesmonteiro"
linkedin_username <- "italomarquesmonteiro"
x_username <- "italommonteiro"
instagram_username <- "italo.m.m"

colors <- "gray40"
title_text <- glue::glue("@ de boi gordo necessária para comprar um bezerro") # nolint
subtitle_text <- glue::glue("")
caption_text <- glue::glue(
  "**Dados:** Centro de Estudos Avançados em Economia Aplicada (Cepea-Esalq)<br>", # nolint
  "**Nota:** Linha tracejada cinza representa o valor médio do período<br>",
  "**Plot:** Ítalo Marques-Monteiro <br><br>",
  "<span style='font-family:\"Font Awesome 6 Brands\"; color: black;'>{github_icon};</span> 
  <span style='color: black'>{github_username}</span><br>",
  "<span style='font-family:\"Font Awesome 6 Brands\"; color: dodgerblue4;'>{linkedin_icon};</span> 
  <span style='color: black'>{linkedin_username}</span><br>",
  "<span style='font-family:\"Font Awesome 6 Brands\"; color: steelblue;'>{x_icon};</span>
  <span style='color: black'>{x_username}</span><br>",
  "<span style='font-family:\"Font Awesome 6 Brands\"; color: red;'>{instagram_icon};</span>
  <span style='color: black'>{instagram_username}</span>"
)
```
  
  
```{r plot} 
plot_relacao_troca <- relacao_troca |>
  ggplot(aes(x = data, y = rt_medio)) +
  geom_col(aes(fill = ifelse(data == max(data), "last",ifelse(data %in% c("2021-10-01", "2004-11-01", "2024-01-01"),"high", "default")))) + # nolint
  scale_fill_manual(values = c(high = "grey50", default = "grey80", last = "goldenrod1", color = "black")) + # nolint
  guides(fill = FALSE) +
  geom_hline(yintercept = 6.61, lty = 3) +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  scale_y_continuous(breaks = seq(0, 12, 1), labels = scales::dollar_format(prefix = "", suffix = "@")) + # nolint
  #labs(title = label_title, caption = label_caption) +
  #theme(
  #      plot.title = ggtext::element_markdown(face = "bold", family = "Source Sans Pro", size = 25, hjust = 0, color = "grey40",), # nolint
  #      plot.caption = element_text(face = "bold", family = "Fira Sans Pro", size = 12, color = "gray70"), # nolint
  #      panel.background = element_rect(fill = "white", color = "grey90"),
  #      plot.background = element_rect(fill = "white"),
  #      panel.grid = element_line(color = "grey90"),
  #      legend.background = element_blank(),
  #      legend.position = c(0.7, 0.8),
  #      legend.key = element_rect(fill = "grey95", color = "grey95"),
  #      legend.text = element_text(color = "grey40", size = 12),
  #      legend.title = element_text(face = "bold", color = "grey40"),
  #      axis.title.x = element_blank(),
  #      axis.title.y = element_blank(),
  #      axis.text.y = ggtext::element_markdown(face = "bold", family = "Fira Sans",size = 8, hjust = 0, color = "gray50"), # nolint,
  #      axis.text.x = ggtext::element_markdown(face = "bold", family = "Fira Sans",size = 8, color = "gray50", angle = 90, hjust = 1, vjust = 1) # nolint
  #)
  labs(
    title = title_text,
      x = "Data",
        caption = caption_text
  ) +
  theme(
        plot.title = ggtext::element_markdown(face = "bold", family = font, size = 25, hjust = 0, color = "gray40",), # nolint
        plot.caption = ggtext::element_markdown(family = font, hjust = 0, margin = margin(10,0,0,0), size = 8, color = txt_col, lineheight = 1.2), # nolint
        panel.background = element_rect(fill = "white", color = "grey90"),
        plot.background = element_rect(fill = "white"),
        panel.grid = element_line(color = "grey90"),
        legend.background = element_blank(),
        legend.position = c(0.7, 0.8),
        legend.key = element_rect(fill = "grey95", color = "grey95"),
        legend.text = element_text(color = "grey40", size = 12),
        legend.title = element_text(face = "bold", color = "grey40"),
        axis.title.x = ggtext::element_markdown(face = "bold", family = font,size = 15, hjust = 0, color = "gray50"), # nolint,
        axis.title.y = element_blank(),
        axis.text.y = ggtext::element_markdown(face = "bold", family = font2,size = 8, hjust = 0, color = "gray50"), # nolint,
        axis.text.x = ggtext::element_markdown(
          face = "bold", family = font2 ,size = 8, color = "gray50", angle=60, hjust=1) # nolint
  )
plot_relacao_troca
```

```{r}
ggsave(".vscode/Graph index/RelaçãoTroca.png", plot = plot_relacao_troca, dpi = 300)
```